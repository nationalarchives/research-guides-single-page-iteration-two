<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<!-- Basic navigation to guides within a category -->
<ul class="research-guide-links">
    <li><a href="#second-world-war">Second World War</a>
        <ul>
            <li><a href="#army">Army</a></li>
            <li><a href="#births-marriages-and-deaths">Births, Marriages and Deaths</a></li>
            <li><a href="#foreign-and-colonial-affairs">Foreign and colonial affairs</a></li>
        </ul>
    </li>
    <li><a href="#social-and-cultural-history">Social and cultural history</a>
        <ul>
            <li><a href="#cultural">Cultural</a></li>
            <li><a href="#education">Education</a></li>
            <li><a href="#health">Health</a></li>
            <li><a href="#land">Land</a></li>
        </ul>
    </li>
    <li><a href="#records-for-current-legal-purposes">Records for current legal purposes</a></li>
</ul>

<!-- Research guides within a section -->
<h2 id="second-world-war">Second World War</h2>

<div data-name="Recommendations for military honours and awards 1935-1990"
     data-categories="second-world-war medals-and-awards"
     data-recommended-guide-for-category="second-world-war"
     data-keywords="army awards gallantry-medals honours medals second-world-war world-war-two"
     data-all-records-available-online="true"
     data-guide-href="http://www.nationalarchives.gov.uk/help-with-your-research/research-guides/recommendations-military-honours-awards-1935-1990/"
     data-available-on-partner="false"
     id="recommendations-military-honours-awards-1935-1990"
     class="research-guide">
    <h3>
        <a href="http://www.nationalarchives.gov.uk/help-with-your-research/research-guides/recommendations-military-honours-awards-1935-1990/">
            Recommendations for military honours and awards 1935-1990
        </a>
    </h3>
</div>

<div data-name="1939 register"
     data-categories="second-world-war"
     data-recommended-guide-for-category="false"
     data-keywords="1939-register census population statistics"
     data-all-records-available-online="true"
     data-guide-href="http://www.nationalarchives.gov.uk/help-with-your-research/research-guides/1939-register/"
     data-available-on-partner="find-my-past"
     id="1939-register"
     class="research-guide">
    <h3>
        <a href="http://www.nationalarchives.gov.uk/help-with-your-research/research-guides/1939-register/">1939
            register</a>
    </h3>
</div>

<!-- JSON representation of guides within a section -->

<script>
    class Guides {
        constructor () {
            this.researchguides = [];
            this.getResearchGuides();
        }
        getResearchGuides () {
            let allRG = document.querySelectorAll("div.research-guide");
            for (let i = 0; i < allRG.length; i++) {
                let currentRG = allRG[i];
                this.researchguides[i] = {
                    "name" : Guides.getName(currentRG),
                    "categories" : Guides.getCategories(currentRG),
                    "recommended_for_category" : Guides.getRecommendedForCategory(currentRG),
                    "keywords" : Guides.getKeywords(currentRG),
                    "all_records_available_online" : Guides.getAllRecordsAvaliableOnline(currentRG),
                    "guide_href" : Guides.getGuideHREF(currentRG),
                    "data_available_on_partner" : Guides.getDataAvailableOnPartner(currentRG),
                    "id" : Guides.getID(currentRG)
                };
            }
        }
        getNumberOfGuides () {
            return this.researchguides.size;
        }
        static getName (currentRG) {
            return currentRG.getAttribute("data-name")
        }
        static getCategories (currentDIV) {
            let categories = currentDIV.getAttribute("data-categories");
            return categories.split(" ");
        }
        static getRecommendedForCategory (currentDIV) {
            if (currentDIV.getAttribute("data-recommended-guide-for-category") === "false") {
                return JSON.parse(currentDIV.getAttribute("data-recommended-guide-for-category"))
            } else {
                return currentDIV.getAttribute("data-recommended-guide-for-category")
            }
        }
        static getKeywords (currentDIV) {
            let keywords = currentDIV.getAttribute("data-keywords");
            return keywords.split(" ");
        }
        static getAllRecordsAvaliableOnline (currentDIV) {
            return JSON.parse(currentDIV.getAttribute("data-all-records-available-online"))
        }
        static getGuideHREF (currentDIV) {
            return currentDIV.getAttribute("data-guide-href")
        }
        static getDataAvailableOnPartner (currentDIV) {
            if (currentDIV.getAttribute("data-available-on-partner") === "false") {
                return JSON.parse(currentDIV.getAttribute("data-available-on-partner"))
            } else {
                return currentDIV.getAttribute("data-available-on-partner")
            }
        }
        static getID (currentDIV) {
            return currentDIV.getAttribute("id");
        }
    }
    class Subjects {
        constructor () {
            this.categories = [];
            this.getCategories();
        }
        getCategories () {
            let parentlist = Subjects.getParentItems();
            let childlist = Subjects.getChildItems();
            for (let i = 0; i < parentlist.length; i++) {
                this.categories.push(Subjects.Category(parentlist[i], false));
                if (childlist !== null) {
                    for (let j=0; j < childlist.length; j++){
                        this.categories.push(Subjects.Category(childlist[j], parentlist[i].firstChild.getAttribute("href")));
                    }
                }
            }
        }
        static getParentItems () {
            return document.querySelectorAll("ul.research-guide-links > li");
        }
        static getChildItems() {
            return document.querySelectorAll("ul li ul li a");
        }
        static Category (currentitem, hasparent) {
            let newitem =  {};
            if (hasparent === false) {
                newitem = {
                    "name": currentitem.firstElementChild.innerHTML,
                    "key": currentitem.firstElementChild.getAttribute("href"),
                    "parent": hasparent
                }
            } else {
                newitem = {
                    "name": currentitem.innerHTML,
                    "key": currentitem.getAttribute("href"),
                    "parent": hasparent
                }
            }
            return newitem;
        }
        numberOfSubjects () {
            return this.categories.length;
        }
    }
    function Research_guides_data () {
        this.subjects = new Subjects();
        this.guides = new Guides();
        this.numberOfSubjects = function () {
            return this.subjects.numberOfSubjects();
        };
        this.numberOfGuides = function () {
            return this.subjects.getNumberOfGuides();
        }
    }
    let research_guides = new Research_guides_data();
    document.write(JSON.stringify(research_guides.subjects));
    document.write("<br>");
    document.write(JSON.stringify(research_guides.guides));
</script>

</body>
</html>